---
import { getLangFromUrl } from '../i18n/utils';
import * as svTranslations from '../i18n/translations/sv';
import * as enTranslations from '../i18n/translations/en';
import * as arTranslations from '../i18n/translations/ar';

const lang = getLangFromUrl(Astro.url);
const translations = lang === 'sv' ? svTranslations : lang === 'en' ? enTranslations : arTranslations;
const faq = translations.faq;

const faqs = faq.faqs;

// Generate FAQPage schema for SEO
const faqSchema = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": faqs.map(faqItem => ({
    "@type": "Question",
    "name": faqItem.question,
    "acceptedAnswer": {
      "@type": "Answer",
      "text": faqItem.answer
    }
  }))
};
---

<script type="application/ld+json" set:html={JSON.stringify(faqSchema)} />

<section id="faq" class="py-20 bg-gray-50 relative overflow-hidden">
  <!-- Subtle background pattern -->
  <div class="absolute inset-0 opacity-5">
    <div class="absolute inset-0 bg-repeat" style="background-image: url('/grid-pattern.svg');"></div>
  </div>

  <div class="container-custom relative">
    <div class="text-center max-w-3xl mx-auto animate-on-scroll">
      <h2 class="text-3xl md:text-4xl font-bold">
        {faq.section.title}
      </h2>
      <p class="mt-4 text-xl text-gray-600">
        {faq.section.subtitle}
      </p>
    </div>

    <div class="mt-12 max-w-3xl mx-auto">
      {faqs.map((faqItem, index) => (
        <div
          class="mb-6 bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden animate-on-scroll faq-item hover:shadow-md transition-all duration-300"
          style={`animation-delay: ${index * 0.1}s`}
        >
          <details class="group">
            <summary class="flex justify-between items-center cursor-pointer p-6 transition-all duration-300 hover:bg-gray-50">
              <h3 class="text-lg font-medium transition-colors duration-300 group-hover:text-blue-600 pr-4">{faqItem.question}</h3>
              <div class="flex-shrink-0 ml-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 group-open:rotate-180 transition-transform duration-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </div>
            </summary>
            <div class="px-6 pb-6 text-gray-600">
              <p>{faqItem.answer}</p>
            </div>
          </details>
        </div>
      ))}
    </div>

    <div class="mt-12 text-center animate-on-scroll">
      <p class="text-gray-600">
        {faq.section.contactText}
      </p>
      <a href={faq.section.contactLink.href} class="mt-4 inline-flex items-center text-blue-600 font-medium hover:underline group">
        {faq.section.contactLink.text}
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1 transition-transform duration-300 group-hover:translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
        </svg>
      </a>
    </div>
  </div>
</section>
